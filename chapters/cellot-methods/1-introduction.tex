\section{Introduction}
Characterizing and modeling perturbation responses at the single-cell level from non-time-resolved data remains one of biology's grand challenges.
It finds applications in predicting cellular reactions to environmental stress or a patient's response to drug treatments.
Accurate inference of perturbation responses at the single cell level allows us,
for instance, to understand how and why individual tumor cells evade cancer therapies \cite{frangieh2021}.
More generally, it deepens the mechanistic understanding of the molecular machinery that determines the respective responses to perturbations.
Single-cell responses to genetic or chemical perturbations are highly heterogeneous \cite{liberali2014} due to multiple factors,
including pre-existing variability in the abundance and subcellular organization of mRNA and proteins \cite{battich2013, battich2015, gut2018, shaffer2017},
cellular states \cite{kramer2022}, and the cellular microenvironment \cite{snijder2009}.
To effectively predict the drug response of each cell in a  population, whether derived from tissue culture or as primary cells from a patient biopsy,
it is thus crucial to incorporate this heterogeneous multivariate subpopulation structure into the analysis.

A fundamental difficulty in learning perturbation responses is that cells are usually fixed and stained or chemically destroyed to obtain these measurements.
Hence, it is only possible to measure the same cells  before or after a perturbation is applied.

Therefore, while we do not have access to a set of \emph{paired} control/perturbed single-cell observations, we do have access to separate \emph{sets} of single-cell observations from control and perturbed cells, respectively.
To subsequently match single cells between conditions and, at the same time, account for cellular heterogeneity is a highly complex pairing problem.

Here, we seek to learn a perturbation model that robustly describes the cellular dynamics upon intervention while still accounting for underlying variability across samples.
Learning the responses on an existing patient cohort enables inference of treatment responses for new, i.e., previously unseen patients,
assuming that we captured the heterogeneous drug reactions of patients during training.
It is crucial, however, to not simply model average perturbation responses of a patient cohort,
but to capture the specificities of a single patient through personalized treatment effect predictions.
% Even though we seek a robust and coherent model, we must ensure that we propose personalized treatment effect predictions rather than average perturbation responses of a patient cohort possibly not capturing the specificities of a single patient.

Previous methods to approximate single-cell perturbation responses fall short of solving this highly complex \emph{pairing} problem while, at the same time,
accounting for cellular heterogeneity and the strong subpopulation structure of cell samples \cite{wu2021,gonzalez-silva2020,li2022}.

Current state-of-the-art methods \cite{lopez2018, lotfollahi2019, yang2020} predict perturbation responses via \emph{linear shifts} in a learned % low-dimensional
latent space.
While this can capture nonlinear cell-type-specific responses, the use of linear interpolations reduces the alignment problem 
to the possibly more challenging task of learning representations that are invariant to the corresponding perturbation.


In this chapter, we introduce \textsc{CellOT}, a novel approach that predicts perturbation responses of single cells by \emph{directly} learning and uncovering maps 
between control and perturbed cell states, thus explicitly accounting for heterogeneous subpopulation structures in multiplexed molecular readouts.
Assuming perturbations incrementally alter molecular profiles of cells, such as gene expression or signaling activities,
we learn these changes and alignments using optimal transportation theory (OT) \cite{villani2009}.
Optimal transport provides natural geometric and mathematical tools to manipulate probability distributions.
It has found recent successes modeling cellular development processes \cite{lavenant2023, schiebinger2019},
albeit in a \emph{non-parameterized} setting.
Thus, current OT-based approaches are unable to make predictions on unseen cells, such as those from unseen samples, e.g., new patients.

% One way to address the pairing problem is to assume that perturbed cellular states are coupled to their initial states under a principle of minimum action.
That is, given unpaired observations of cells before and after perturbation,
we would aim to pair cells to their treated states in such a way that the average distance between the pairs, in feature space, is minimal.
This setting is ideally suited for acute cellular perturbations during which single cells do not redistribute entirely and randomly in multidimensional measurement space,
but typically only in a few dimensions, maintaining the overall correlation structure.

Based on recent developments in neural optimal transport \cite{makkuva2020},
\textsc{CellOT} learns an optimal transport map for each perturbation in a fully parameterized and highly scalable manner.
Instead of directly learning a transport map \cite{leygonie2019, yang2020, prasad2022},
\textsc{CellOT} parameterizes a pair of dual potentials with convex neural networks \cite{amos2017}.
This choice induces an important theory-motivated inductive bias essential to model stability \cite{makkuva2020}.


We demonstrate \textsc{CellOT}'s effectiveness biopsy
(i) learning single-cell marker responses to different cancer drugs in melanoma cell lines,
(ii) predicting single-cell transcriptome responses in biopsies of patients with systemic lupus erythematosus as well as Panobinostat treatment outcomes of glioblastoma patients,
(iii) inferring LPS responses across different animal species,
and (iv) modeling the transcriptome evolution of cell fates in hematopoiesis.
Moreover, we benchmark \textsc{CellOT} against current state-of-the-art methods on multiple tasks \cite{lopez2018, lotfollahi2019}.

